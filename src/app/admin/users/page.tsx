'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { \n  Users, \n  Search, \n  Filter, \n  Plus, \n  Edit, \n  Trash2, \n  Check, \n  X, \n  Shield, \n  ShieldAlert,\n  Mail,\n  Phone,\n  Calendar,\n  MoreHorizontal,\n  UserCheck,\n  UserX\n} from 'lucide-react';\nimport { useAuthStore } from '@/store/auth';\nimport { toast } from 'sonner';\nimport { format } from 'date-fns';\nimport { fr } from 'date-fns/locale';\n\ninterface User {\n  id: string;\n  firstName: string;\n  lastName: string;\n  email: string;\n  role: 'STUDENT' | 'TEACHER' | 'ADMIN';\n  status: 'ACTIVE' | 'PENDING' | 'SUSPENDED';\n  studentId?: string;\n  department?: string;\n  semester?: string;\n  phone?: string;\n  avatar?: string;\n  createdAt: string;\n  lastLogin?: string;\n}\n\nconst mockUsers: User[] = [\n  {\n    id: '1',\n    firstName: 'Admin',\n    lastName: 'Système',\n    email: 'admin@campus.fr',\n    role: 'ADMIN',\n    status: 'ACTIVE',\n    department: 'Administration',\n    createdAt: '2024-01-01T00:00:00Z',\n    lastLogin: '2024-01-24T10:30:00Z'\n  },\n  {\n    id: '2',\n    firstName: 'Prof. Jean',\n    lastName: 'Martin',\n    email: 'prof@campus.fr',\n    role: 'TEACHER',\n    status: 'ACTIVE',\n    department: 'Informatique',\n    phone: '+33 1 23 45 67 89',\n    createdAt: '2024-01-01T00:00:00Z',\n    lastLogin: '2024-01-24T09:15:00Z'\n  },\n  {\n    id: '3',\n    firstName: 'Marie',\n    lastName: 'Dupont',\n    email: 'etudiant@campus.fr',\n    role: 'STUDENT',\n    status: 'ACTIVE',\n    studentId: 'M2-2024-001',\n    department: 'Informatique',\n    semester: 'S1 2024',\n    createdAt: '2024-01-15T00:00:00Z',\n    lastLogin: '2024-01-24T08:45:00Z'\n  },\n  {\n    id: '4',\n    firstName: 'Pierre',\n    lastName: 'Durand',\n    email: 'pierre.durand@campus.fr',\n    role: 'STUDENT',\n    status: 'PENDING',\n    studentId: 'M2-2024-002',\n    department: 'Informatique',\n    semester: 'S1 2024',\n    createdAt: '2024-01-23T00:00:00Z'\n  },\n  {\n    id: '5',\n    firstName: 'Sophie',\n    lastName: 'Bernard',\n    email: 'sophie.bernard@campus.fr',\n    role: 'STUDENT',\n    status: 'SUSPENDED',\n    studentId: 'M2-2024-003',\n    department: 'Informatique',\n    semester: 'S1 2024',\n    createdAt: '2024-01-10T00:00:00Z',\n    lastLogin: '2024-01-20T14:20:00Z'\n  }\n];\n\nexport default function AdminUsersPage() {\n  const { user } = useAuthStore();\n  const [users, setUsers] = useState<User[]>(mockUsers);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedRole, setSelectedRole] = useState<string>('all');\n  const [selectedStatus, setSelectedStatus] = useState<string>('all');\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\n  \n  // New user form\n  const [newUser, setNewUser] = useState({\n    firstName: '',\n    lastName: '',\n    email: '',\n    role: 'STUDENT' as const,\n    department: '',\n    studentId: '',\n    phone: ''\n  });\n\n  const handleApproveUser = (userId: string) => {\n    setUsers(prev => prev.map(u => \n      u.id === userId ? { ...u, status: 'ACTIVE' as const } : u\n    ));\n    toast.success('Utilisateur approuvé');\n  };\n\n  const handleSuspendUser = (userId: string) => {\n    setUsers(prev => prev.map(u => \n      u.id === userId ? { ...u, status: 'SUSPENDED' as const } : u\n    ));\n    toast.success('Utilisateur suspendu');\n  };\n\n  const handleReactivateUser = (userId: string) => {\n    setUsers(prev => prev.map(u => \n      u.id === userId ? { ...u, status: 'ACTIVE' as const } : u\n    ));\n    toast.success('Utilisateur réactivé');\n  };\n\n  const handleDeleteUser = (userId: string) => {\n    setUsers(prev => prev.filter(u => u.id !== userId));\n    toast.success('Utilisateur supprimé');\n  };\n\n  const handleCreateUser = () => {\n    if (!newUser.firstName || !newUser.lastName || !newUser.email) {\n      toast.error('Veuillez remplir tous les champs obligatoires');\n      return;\n    }\n\n    const user: User = {\n      id: `user-${Date.now()}`,\n      firstName: newUser.firstName,\n      lastName: newUser.lastName,\n      email: newUser.email,\n      role: newUser.role,\n      status: 'ACTIVE',\n      department: newUser.department,\n      studentId: newUser.role === 'STUDENT' ? newUser.studentId : undefined,\n      phone: newUser.phone,\n      createdAt: new Date().toISOString()\n    };\n\n    setUsers(prev => [user, ...prev]);\n    setNewUser({\n      firstName: '',\n      lastName: '',\n      email: '',\n      role: 'STUDENT',\n      department: '',\n      studentId: '',\n      phone: ''\n    });\n    setIsCreateDialogOpen(false);\n    toast.success('Utilisateur créé avec succès');\n  };\n\n  const filteredUsers = users.filter(user => {\n    const matchesSearch = \n      user.firstName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      user.lastName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      (user.studentId && user.studentId.toLowerCase().includes(searchTerm.toLowerCase()));\n    \n    const matchesRole = selectedRole === 'all' || user.role === selectedRole;\n    const matchesStatus = selectedStatus === 'all' || user.status === selectedStatus;\n    \n    return matchesSearch && matchesRole && matchesStatus;\n  });\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'ACTIVE':\n        return <Badge className=\"bg-green-100 text-green-800\">Actif</Badge>;\n      case 'PENDING':\n        return <Badge className=\"bg-yellow-100 text-yellow-800\">En attente</Badge>;\n      case 'SUSPENDED':\n        return <Badge className=\"bg-red-100 text-red-800\">Suspendu</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  const getRoleBadge = (role: string) => {\n    switch (role) {\n      case 'ADMIN':\n        return <Badge className=\"bg-purple-100 text-purple-800\">Admin</Badge>;\n      case 'TEACHER':\n        return <Badge className=\"bg-blue-100 text-blue-800\">Enseignant</Badge>;\n      case 'STUDENT':\n        return <Badge className=\"bg-gray-100 text-gray-800\">Étudiant</Badge>;\n      default:\n        return <Badge variant=\"outline\">{role}</Badge>;\n    }\n  };\n\n  const pendingUsers = users.filter(u => u.status === 'PENDING');\n  const activeUsers = users.filter(u => u.status === 'ACTIVE');\n  const suspendedUsers = users.filter(u => u.status === 'SUSPENDED');\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Gestion des utilisateurs</h1>\n          <p className=\"text-gray-600 mt-1\">Gérez les comptes utilisateurs de la plateforme</p>\n        </div>\n        \n        <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"bg-blue-600 hover:bg-blue-700\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Nouvel utilisateur\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>Créer un nouvel utilisateur</DialogTitle>\n              <DialogDescription>\n                Ajoutez un nouvel utilisateur à la plateforme\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"firstName\">Prénom</Label>\n                  <Input\n                    id=\"firstName\"\n                    value={newUser.firstName}\n                    onChange={(e) => setNewUser({...newUser, firstName: e.target.value})}\n                    placeholder=\"Prénom\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"lastName\">Nom</Label>\n                  <Input\n                    id=\"lastName\"\n                    value={newUser.lastName}\n                    onChange={(e) => setNewUser({...newUser, lastName: e.target.value})}\n                    placeholder=\"Nom de famille\"\n                  />\n                </div>\n              </div>\n              \n              <div>\n                <Label htmlFor=\"email\">Email</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={newUser.email}\n                  onChange={(e) => setNewUser({...newUser, email: e.target.value})}\n                  placeholder=\"email@campus.fr\"\n                />\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"role\">Rôle</Label>\n                  <Select value={newUser.role} onValueChange={(value: any) => setNewUser({...newUser, role: value})}>\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"STUDENT\">Étudiant</SelectItem>\n                      <SelectItem value=\"TEACHER\">Enseignant</SelectItem>\n                      <SelectItem value=\"ADMIN\">Administrateur</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"department\">Département</Label>\n                  <Input\n                    id=\"department\"\n                    value={newUser.department}\n                    onChange={(e) => setNewUser({...newUser, department: e.target.value})}\n                    placeholder=\"Informatique\"\n                  />\n                </div>\n              </div>\n              \n              {newUser.role === 'STUDENT' && (\n                <div>\n                  <Label htmlFor=\"studentId\">Numéro étudiant</Label>\n                  <Input\n                    id=\"studentId\"\n                    value={newUser.studentId}\n                    onChange={(e) => setNewUser({...newUser, studentId: e.target.value})}\n                    placeholder=\"M2-2024-XXX\"\n                  />\n                </div>\n              )}\n              \n              <div>\n                <Label htmlFor=\"phone\">Téléphone (optionnel)</Label>\n                <Input\n                  id=\"phone\"\n                  value={newUser.phone}\n                  onChange={(e) => setNewUser({...newUser, phone: e.target.value})}\n                  placeholder=\"+33 1 23 45 67 89\"\n                />\n              </div>\n              \n              <div className=\"flex justify-end space-x-2\">\n                <Button variant=\"outline\" onClick={() => setIsCreateDialogOpen(false)}>\n                  Annuler\n                </Button>\n                <Button onClick={handleCreateUser}>\n                  Créer l'utilisateur\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total utilisateurs</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{users.length}</div>\n            <p className=\"text-xs text-muted-foreground\">Tous statuts confondus</p>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Utilisateurs actifs</CardTitle>\n            <UserCheck className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">{activeUsers.length}</div>\n            <p className=\"text-xs text-muted-foreground\">Comptes validés</p>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">En attente</CardTitle>\n            <Shield className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-yellow-600\">{pendingUsers.length}</div>\n            <p className=\"text-xs text-muted-foreground\">Approbation requise</p>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Suspendus</CardTitle>\n            <UserX className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\">{suspendedUsers.length}</div>\n            <p className=\"text-xs text-muted-foreground\">Comptes désactivés</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex flex-col md:flex-row gap-4\">\n            <div className=\"flex-1\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n                <Input\n                  placeholder=\"Rechercher par nom, email ou numéro étudiant...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n            \n            <Select value={selectedRole} onValueChange={setSelectedRole}>\n              <SelectTrigger className=\"w-48\">\n                <SelectValue placeholder=\"Filtrer par rôle\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">Tous les rôles</SelectItem>\n                <SelectItem value=\"STUDENT\">Étudiants</SelectItem>\n                <SelectItem value=\"TEACHER\">Enseignants</SelectItem>\n                <SelectItem value=\"ADMIN\">Administrateurs</SelectItem>\n              </SelectContent>\n            </Select>\n            \n            <Select value={selectedStatus} onValueChange={setSelectedStatus}>\n              <SelectTrigger className=\"w-48\">\n                <SelectValue placeholder=\"Filtrer par statut\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">Tous les statuts</SelectItem>\n                <SelectItem value=\"ACTIVE\">Actifs</SelectItem>\n                <SelectItem value=\"PENDING\">En attente</SelectItem>\n                <SelectItem value=\"SUSPENDED\">Suspendus</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Users Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Liste des utilisateurs</CardTitle>\n          <CardDescription>\n            {filteredUsers.length} utilisateur(s) trouvé(s)\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Utilisateur</TableHead>\n                <TableHead>Rôle</TableHead>\n                <TableHead>Statut</TableHead>\n                <TableHead>Département</TableHead>\n                <TableHead>Dernière connexion</TableHead>\n                <TableHead>Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredUsers.map((user) => (\n                <TableRow key={user.id}>\n                  <TableCell>\n                    <div className=\"flex items-center space-x-3\">\n                      <Avatar>\n                        <AvatarImage src={user.avatar} />\n                        <AvatarFallback>\n                          {user.firstName[0]}{user.lastName[0]}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div>\n                        <div className=\"font-medium\">\n                          {user.firstName} {user.lastName}\n                        </div>\n                        <div className=\"text-sm text-gray-500\">\n                          {user.email}\n                        </div>\n                        {user.studentId && (\n                          <div className=\"text-xs text-gray-400\">\n                            {user.studentId}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </TableCell>\n                  <TableCell>{getRoleBadge(user.role)}</TableCell>\n                  <TableCell>{getStatusBadge(user.status)}</TableCell>\n                  <TableCell>{user.department}</TableCell>\n                  <TableCell>\n                    {user.lastLogin ? (\n                      <span className=\"text-sm\">\n                        {format(new Date(user.lastLogin), 'dd MMM yyyy', { locale: fr })}\n                      </span>\n                    ) : (\n                      <span className=\"text-sm text-gray-400\">Jamais</span>\n                    )}\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex items-center space-x-2\">\n                      {user.status === 'PENDING' && (\n                        <>\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => handleApproveUser(user.id)}\n                            className=\"text-green-600 hover:text-green-700\"\n                          >\n                            <Check className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => handleDeleteUser(user.id)}\n                            className=\"text-red-600 hover:text-red-700\"\n                          >\n                            <X className=\"w-4 h-4\" />\n                          </Button>\n                        </>\n                      )}\n                      \n                      {user.status === 'ACTIVE' && (\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => handleSuspendUser(user.id)}\n                          className=\"text-red-600 hover:text-red-700\"\n                        >\n                          <ShieldAlert className=\"w-4 h-4\" />\n                        </Button>\n                      )}\n                      \n                      {user.status === 'SUSPENDED' && (\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => handleReactivateUser(user.id)}\n                          className=\"text-green-600 hover:text-green-700\"\n                        >\n                          <Shield className=\"w-4 h-4\" />\n                        </Button>\n                      )}\n                      \n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => {\n                          setSelectedUser(user);\n                          setIsEditDialogOpen(true);\n                        }}\n                      >\n                        <Edit className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}"